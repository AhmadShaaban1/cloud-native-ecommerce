# Prometheus - Optimized for 4x t3.small nodes
prometheus:
  prometheusSpec:
    retention: 7d
    retentionSize: "5GB"
    
    resources:
      requests:
        cpu: 150m
        memory: 512Mi
      limits:
        cpu: 500m
        memory: 1Gi
    
    # Use EBS storage
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: ebs-sc
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 10Gi
    
    serviceMonitorSelectorNilUsesHelmValues: false
    podMonitorSelectorNilUsesHelmValues: false

# Grafana
grafana:
  enabled: true
  adminPassword: "admin123"
  
  service:
    type: ClusterIP
  
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 200m
      memory: 512Mi
  
  # Use EBS storage
  persistence:
    enabled: true
    storageClassName: ebs-sc
    size: 5Gi
  
  defaultDashboardsEnabled: true
  
  # Loki datasource - CORRECT URL
  additionalDataSources:
  - name: Loki
    type: loki
    access: proxy
    url: http://loki-gateway.monitoring.svc.cluster.local
    jsonData:
      maxLines: 1000

# Alertmanager
alertmanager:
  enabled: true
  
  alertmanagerSpec:
    resources:
      requests:
        cpu: 50m
        memory: 128Mi
      limits:
        cpu: 100m
        memory: 256Mi
    
    storage:
      volumeClaimTemplate:
        spec:
          storageClassName: ebs-sc
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 2Gi

# Node Exporter
nodeExporter:
  enabled: true
  resources:
    requests:
      cpu: 20m
      memory: 50Mi
    limits:
      cpu: 50m
      memory: 100Mi

# Kube State Metrics
kubeStateMetrics:
  enabled: true
  resources:
    requests:
      cpu: 20m
      memory: 50Mi
    limits:
      cpu: 100m
      memory: 150Mi

# Prometheus Operator
prometheusOperator:
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 200m
      memory: 512Mi
  
  admissionWebhooks:
    enabled: true
    patch:
      enabled: true